<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PersonaForge</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-tab="status">üìä</button>
            <button class="nav-btn" data-tab="personas">üé≠</button>
            <button class="nav-btn" data-tab="chats">üí¨</button>
            <button class="nav-btn" data-tab="security">üõ°Ô∏è</button>
            <button class="nav-btn" data-tab="config">‚öôÔ∏è</button>
        </nav>

        <!-- Status Tab -->
        <section id="status" class="tab active">
            <h2>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
            
            <!-- Pause Button -->
            <div class="pause-container">
                <button id="pause-btn" class="btn btn-pause" onclick="togglePause()">
                    <span id="pause-icon">‚è∏Ô∏è</span>
                    <span id="pause-text">–ü–∞—É–∑–∞</span>
                </button>
            </div>
            
            <div class="status-grid" id="status-grid">
                <div class="status-card">
                    <span class="status-icon" id="ollama-status">‚è≥</span>
                    <span>Ollama</span>
                </div>
                <div class="status-card">
                    <span class="status-icon" id="db-status">‚è≥</span>
                    <span>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</span>
                </div>
            </div>
            
            <div class="info-card">
                <h3>–ê–∫—Ç–∏–≤–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞</h3>
                <p id="active-persona">‚Äî</p>
            </div>

            <div class="info-card">
                <h3>–û—á–µ—Ä–µ–¥—å LLM</h3>
                <div class="queue-stats">
                    <div><span id="queue-available">0</span>/<span id="queue-max">3</span> —Å–ª–æ—Ç–æ–≤</div>
                    <div>–ó–∞–ø—Ä–æ—Å–æ–≤: <span id="total-requests">0</span></div>
                    <div>‚úÖ <span id="success-requests">0</span> ‚ùå <span id="failed-requests">0</span></div>
                    <div>‚è±Ô∏è <span id="avg-time">0</span>–º—Å</div>
                </div>
            </div>

            <div class="info-card">
                <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                <div class="config-list">
                    <div>–ú–æ–¥–µ–ª—å: <span id="model-name">‚Äî</span></div>
                    <div>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: <span id="temperature">‚Äî</span></div>
                    <div>–¢–æ–∫–µ–Ω—ã: <span id="max-tokens">‚Äî</span></div>
                    <div id="features-list"></div>
                </div>
            </div>
        </section>

        <!-- Personas Tab -->
        <section id="personas" class="tab">
            <h2>–ü–µ—Ä—Å–æ–Ω—ã</h2>
            <button class="btn btn-primary" onclick="showCreatePersona()">+ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω—É</button>
            <div id="personas-list" class="list"></div>
        </section>

        <!-- Chats Tab -->
        <section id="chats" class="tab">
            <h2>–ß–∞—Ç—ã</h2>
            <div id="chats-list" class="list"></div>
        </section>

        <!-- Security Tab -->
        <section id="security" class="tab">
            <h2>üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
            
            <div class="info-card">
                <h3>–ó–∞—â–∏—Ç–∞ –æ—Ç Prompt Injection</h3>
                <div class="config-list">
                    <div>‚Ä¢ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞</div>
                    <div>‚Ä¢ –î–µ—Ç–µ–∫—Ü–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</div>
                    <div>‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π rate limiting</div>
                    <div>‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</div>
                </div>
            </div>

            <div class="info-card">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <div class="config-list">
                    <div>–ü–æ—Ä–æ–≥ —Å—Ç—Ä–∞–π–∫–∞: <strong>30</strong> risk score</div>
                    <div>–°—Ç—Ä–∞–π–∫–æ–≤ –¥–æ –±–ª–æ–∫–∞: <strong>3</strong></div>
                    <div>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–æ–∫–∞: <strong>5 –º–∏–Ω</strong></div>
                    <div>–û–∫–Ω–æ —Å—Ç—Ä–∞–π–∫–æ–≤: <strong>1 —á–∞—Å</strong></div>
                </div>
            </div>

            <div class="info-card">
                <h3>Rate Limiting</h3>
                <div class="config-list">
                    <div>0 –Ω–∞—Ä—É—à–µ–Ω–∏–π: <strong>20</strong> msg/min</div>
                    <div>1-2 –Ω–∞—Ä—É—à–µ–Ω–∏—è: <strong>15</strong> msg/min</div>
                    <div>3-5 –Ω–∞—Ä—É—à–µ–Ω–∏–π: <strong>10</strong> msg/min</div>
                    <div>6+ –Ω–∞—Ä—É—à–µ–Ω–∏–π: <strong>3-5</strong> msg/min</div>
                </div>
            </div>

            <div class="info-card">
                <h3>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <div class="form-group">
                    <label>User ID</label>
                    <input type="number" id="check-user-id" placeholder="123456789">
                </div>
                <button class="btn btn-secondary" onclick="checkUserSecurity()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            </div>

            <div id="security-result" class="info-card hidden">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                <div id="security-result-content"></div>
                <div class="list-item-actions" style="margin-top: 12px;">
                    <button class="btn btn-small btn-danger" id="block-user-btn" onclick="blockUserFromCheck()">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-small btn-secondary" id="unblock-user-btn" onclick="unblockUserFromCheck()">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </section>

        <!-- Settings Tab -->
        <section id="config" class="tab">
            <h2>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
            <div id="config-form">
                <div class="info-card">
                    <h3>ü§ñ –ú–æ–¥–µ–ª–∏</h3>
                    <div class="form-group">
                        <label>Chat –º–æ–¥–µ–ª—å</label>
                        <input type="text" id="cfg-chat-model" placeholder="gemma2:2b">
                    </div>
                    <div class="form-group">
                        <label>Embedding –º–æ–¥–µ–ª—å</label>
                        <input type="text" id="cfg-embed-model" placeholder="nomic-embed-text">
                    </div>
                    <div class="form-group">
                        <label>Vision –º–æ–¥–µ–ª—å</label>
                        <input type="text" id="cfg-vision-model" placeholder="llava:latest">
                    </div>
                </div>

                <div class="info-card">
                    <h3>‚ö° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è</h3>
                    <div class="form-group">
                        <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (0.0 - 2.0)</label>
                        <input type="number" id="cfg-temperature" step="0.1" min="0" max="2">
                    </div>
                    <div class="form-group">
                        <label>–ú–∞–∫—Å. —Ç–æ–∫–µ–Ω–æ–≤</label>
                        <input type="number" id="cfg-max-tokens" min="100" max="8192">
                    </div>
                    <div class="form-group">
                        <label>–¢–∞–π–º–∞—É—Ç LLM (—Å–µ–∫)</label>
                        <input type="number" id="cfg-llm-timeout" min="10" max="600">
                    </div>
                    <div class="form-group">
                        <label>–ú–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</label>
                        <input type="number" id="cfg-max-concurrent" min="1" max="10">
                    </div>
                </div>

                <div class="info-card">
                    <h3>üß† RAG –∏ –ø–∞–º—è—Ç—å</h3>
                    <div class="form-group">
                        <label>–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞—Ç—É—Ö–∞–Ω–∏—è (0.0 - 1.0)</label>
                        <input type="number" id="cfg-decay-rate" step="0.05" min="0" max="1">
                    </div>
                    <div class="form-group">
                        <label>–ü–æ—Ä–æ–≥ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ (—Å–æ–æ–±—â–µ–Ω–∏–π)</label>
                        <input type="number" id="cfg-summary-threshold" min="10" max="200">
                    </div>
                </div>

                <div class="info-card">
                    <h3>üéõÔ∏è –§—É–Ω–∫—Ü–∏–∏</h3>
                    <div class="toggle-row">
                        <span>üëÅÔ∏è Vision (–∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)</span>
                        <label class="toggle">
                            <input type="checkbox" id="cfg-vision-enabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <span>üé§ Voice (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏)</span>
                        <label class="toggle">
                            <input type="checkbox" id="cfg-voice-enabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <span>üåê Web Search</span>
                        <label class="toggle">
                            <input type="checkbox" id="cfg-web-search">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (0.0 - 1.0)</label>
                        <input type="number" id="cfg-random-reply" step="0.01" min="0" max="1">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
            
            <h2 style="margin-top: 24px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–æ–≤</h2>
            <div id="stats-list" class="list"></div>
        </section>

        <!-- Modals -->
        <div id="modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Modal</h3>
                    <button class="close-btn" onclick="closeModal()">√ó</button>
                </div>
                <div id="modal-body"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
