# ü§ñ PersonaForge

**Telegram-–±–æ—Ç —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ AI-–ø–µ—Ä—Å–æ–Ω–∞–º–∏, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç—å—é –∏ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.**

–°–æ–∑–¥–∞–≤–∞–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ AI-–ª–∏—á–Ω–æ—Å—Ç–∏, –æ–±—â–∞–π—Å—è –≥–æ–ª–æ—Å–æ–º, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Äî –≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Ollama.

![Rust](https://img.shields.io/badge/Rust-000000?style=flat&logo=rust&logoColor=white)
![Telegram](https://img.shields.io/badge/Telegram-2CA5E0?style=flat&logo=telegram&logoColor=white)
![Ollama](https://img.shields.io/badge/Ollama-Local_LLM-blue)
![SQLite](https://img.shields.io/badge/SQLite-07405E?style=flat&logo=sqlite&logoColor=white)

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üé≠ –ü–µ—Ä—Å–æ–Ω—ã
- –°–æ–∑–¥–∞–≤–∞–π AI-–ª–∏—á–Ω–æ—Å—Ç–∏ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞–º–∏
- –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Å—è –º–µ–∂–¥—É –ø–µ—Ä—Å–æ–Ω–∞–º–∏ –Ω–∞ –ª–µ—Ç—É
- –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω –≤ JSON
- –ö–∞–∂–¥–∞—è –ø–µ—Ä—Å–æ–Ω–∞ ‚Äî —Å–≤–æ–π —Å—Ç–∏–ª—å, –∑–Ω–∞–Ω–∏—è, –º–∞–Ω–µ—Ä–∞ –æ–±—â–µ–Ω–∏—è

### üß† RAG-–ø–∞–º—è—Ç—å
- –ë–æ—Ç –ø–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π
- Time-decay: —Å–≤–µ–∂–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–∞–∂–Ω–µ–µ —Å—Ç–∞—Ä—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤

### üé§ –ì–æ–ª–æ—Å
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Whisper
- –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–∞–∫ –Ω–∞ —Ç–µ–∫—Å—Ç

### üëÅÔ∏è –ó—Ä–µ–Ω–∏–µ
- –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ multimodal –º–æ–¥–µ–ª–∏
- –û–ø–∏—Å–∞–Ω–∏–µ, –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º

### üåê –í–µ–±-–ø–æ–∏—Å–∫
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DuckDuckGo
- –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö

### üéØ –¢—Ä–∏–≥–≥–µ—Ä—ã
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤

### üó£Ô∏è –ò–º—è –±–æ—Ç–∞
- –ë–æ—Ç –∑–Ω–∞–µ—Ç —Å–≤–æ—ë –∏–º—è –∏–∑ Telegram –ø—Ä–æ—Ñ–∏–ª—è
- –û—Ç–∫–ª–∏–∫–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –µ–≥–æ –Ω–∞–∑—ã–≤–∞—é—Ç –ø–æ –∏–º–µ–Ω–∏
- –ò–º—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç

### ‚è∏Ô∏è –ü–∞—É–∑–∞
- –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π
- –î–æ—Å—Ç—É–ø–Ω–æ –≤ –º–µ–Ω—é –∏ Mini App
- –ö–æ–º–∞–Ω–¥—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–∞–∂–µ –Ω–∞ –ø–∞—É–∑–µ

### üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–ø–∏–∫–æ–≤
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞—Ö —Å —Ñ–æ—Ä—É–º–∞–º–∏
- –û—Ç–≤–µ—á–∞–µ—Ç –≤ —Ç–æ–º –∂–µ —Ç–æ–ø–∏–∫–µ –≥–¥–µ –Ω–∞–ø–∏—Å–∞–ª–∏
- Typing indicator –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ç–æ–ø–∏–∫–µ

### ‚å®Ô∏è –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
- –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ø–µ—á–∞—Ç–∞–µ—Ç..." –ø–æ–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üìù Markdown –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Telegram MarkdownV2
- –ñ–∏—Ä–Ω—ã–π, –∫—É—Ä—Å–∏–≤, –∫–æ–¥, –±–ª–æ–∫–∏ –∫–æ–¥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ plain text –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞

### üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç Prompt Injection
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- –î–µ—Ç–µ–∫—Ü–∏—è 40+ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∞—Ç–∞–∫ (EN/RU)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π rate limiting –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ —Ä–æ–ª–µ–π –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [Rust](https://rustup.rs/) 1.70+
- [Ollama](https://ollama.ai/) —Å –º–æ–¥–µ–ª—è–º–∏
- Telegram Bot Token ([@BotFather](https://t.me/BotFather))

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/yourusername/persona-forge.git
cd persona-forge

# –°–∫–æ–ø–∏—Ä—É–π –∫–æ–Ω—Ñ–∏–≥
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π .env
nano .env

# –ó–∞–ø—É—Å—Ç–∏
cargo run --release
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π .env

```env
TELOXIDE_TOKEN=your_bot_token_here
OWNER_ID=your_telegram_id
DATABASE_URL=sqlite:persona_forge.db

OLLAMA_URL=http://localhost:11434
OLLAMA_CHAT_MODEL=llama3.2
OLLAMA_EMBEDDING_MODEL=nomic-embed-text
```

### Docker

```bash
docker-compose up --build
```

---

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Inline-–º–µ–Ω—é
–û—Ç–ø—Ä–∞–≤—å `/menu` ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é —Å–æ –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏:

```
ü§ñ PersonaForge

üé≠ –ü–µ—Ä—Å–æ–Ω—ã     ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥
üí¨ –ß–∞—Ç         üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
üìä –°—Ç–∞—Ç—É—Å       ‚ùì –ü–æ–º–æ—â—å
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ |
| `/menu` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/status` | –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ |
| `/cancel` | –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è (wizard) |

### –ü–µ—Ä—Å–æ–Ω—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/create_persona –Ω–∞–∑–≤–∞–Ω–∏–µ\|–ø—Ä–æ–º–ø—Ç` | –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω—É |
| `/list_personas` | –°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω |
| `/activate_persona ID` | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å |
| `/delete_persona ID` | –£–¥–∞–ª–∏—Ç—å |
| `/export_persona ID` | –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON |
| `/import_persona` | –ò–º–ø–æ—Ä—Ç –∏–∑ JSON |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/set_model –Ω–∞–∑–≤–∞–Ω–∏–µ` | –°–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å |
| `/set_temperature 0.7` | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (0.0-2.0) |
| `/set_max_tokens 2048` | –ú–∞–∫—Å. —Ç–æ–∫–µ–Ω–æ–≤ |
| `/enable_rag` / `/disable_rag` | RAG-–ø–∞–º—è—Ç—å |
| `/triggers —Å–ª–æ–≤–æ1, —Å–ª–æ–≤–æ2` | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ |

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/block user_id [–º–∏–Ω]` | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/unblock user_id` | –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å |
| `/security_status [user_id]` | –°—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |


## üì± Mini App (Web Panel)

–í–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–æ—Ç–∞ ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä—è–º–æ –≤ Telegram.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Mini App

- **üìä Status** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Ollama, –ë–î, –æ—á–µ—Ä–µ–¥–∏ LLM –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **üé≠ Personas** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω
- **üí¨ Chats** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
- **üõ°Ô∏è Security** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π
- **‚öôÔ∏è Config** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, —Ç–æ–∫–µ–Ω–æ–≤, —Ç–æ–≥–≥–ª–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mini App

1. **–ó–∞–ø—É—Å—Ç–∏ —Ç—É–Ω–Ω–µ–ª—å** (–¥–ª—è HTTPS):
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: serveo.net (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
ssh -R 80:localhost:8080 serveo.net

# –í–∞—Ä–∏–∞–Ω—Ç 2: ngrok (–Ω—É–∂–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
ngrok http 8080

# –í–∞—Ä–∏–∞–Ω—Ç 3: cloudflared
cloudflared tunnel --url http://localhost:8080
```

2. **–°–æ–∑–¥–∞–π Mini App –≤ BotFather**:
```
/newapp
‚Üí –í—ã–±–µ—Ä–∏ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞
‚Üí –ù–∞–∑–≤–∞–Ω–∏–µ: PersonaForge Panel
‚Üí –û–ø–∏—Å–∞–Ω–∏–µ: Owner control panel
‚Üí URL: https://your-tunnel-url.com
```

3. **–î–æ–±–∞–≤—å –∫–Ω–æ–ø–∫—É –º–µ–Ω—é**:
```
/setmenubutton
‚Üí –í—ã–±–µ—Ä–∏ –±–æ—Ç–∞
‚Üí –¢–∏–ø: web_app
‚Üí –¢–µ–∫—Å—Ç: üéõÔ∏è Panel
‚Üí URL: https://your-tunnel-url.com
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

Mini App –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram WebApp authentication:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `initData` —á–µ—Ä–µ–∑ HMAC-SHA256
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è `OWNER_ID`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

### API Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/api/status` | GET | –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã |
| `/api/personas` | GET | –°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω |
| `/api/personas` | POST | –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω—É |
| `/api/personas/:id` | PUT | –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω—É |
| `/api/personas/:id` | DELETE | –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω—É |
| `/api/personas/:id/activate` | POST | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å |
| `/api/chats` | GET | –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ |
| `/api/chats/:id` | PUT | –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `/api/config` | GET | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ |
| `/api/config` | POST | –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ |
| `/api/security` | GET | –ö–æ–Ω—Ñ–∏–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| `/api/security/users/:id` | GET | –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/api/security/users/:id/block` | POST | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å |
| `/api/security/users/:id/unblock` | POST | –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å |
| `/api/pause` | GET | –°—Ç–∞—Ç—É—Å –ø–∞—É–∑—ã |
| `/api/pause` | POST | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø–∞—É–∑—É |

### Runtime Config

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ Mini App —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:
- `ollama_chat_model` ‚Äî –º–æ–¥–µ–ª—å –¥–ª—è —á–∞—Ç–∞
- `temperature` ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `max_tokens` ‚Äî –º–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤
- `vision_enabled`, `voice_enabled`, `web_search_enabled` ‚Äî —Ç–æ–≥–≥–ª—ã —Ñ—É–Ω–∫—Ü–∏–π

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ–ª–Ω—ã–π .env

```env
# === Telegram ===
TELOXIDE_TOKEN=your_bot_token
OWNER_ID=123456789
BOT_NAME=PersonaForge

# === Database ===
DATABASE_URL=sqlite:persona_forge.db

# === Ollama ===
OLLAMA_URL=http://localhost:11434
OLLAMA_CHAT_MODEL=llama3.2
OLLAMA_EMBEDDING_MODEL=nomic-embed-text
OLLAMA_VISION_MODEL=llava

# === Generation ===
TEMPERATURE=0.7
MAX_TOKENS=2048
LLM_TIMEOUT_SECONDS=120

# === Features ===
VISION_ENABLED=true
VOICE_ENABLED=true
WEB_SEARCH_ENABLED=true

# === Whisper (–¥–ª—è –≥–æ–ª–æ—Å–∞) ===
WHISPER_URL=http://localhost:8080/inference

# === RAG ===
RAG_DECAY_RATE=0.1
SUMMARY_THRESHOLD=50

# === Queue ===
MAX_CONCURRENT_LLM_REQUESTS=3
QUEUE_TIMEOUT_SECONDS=30

# === Behavior ===
RANDOM_REPLY_PROBABILITY=0.0

# === WebApp (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ===
WEBAPP_PORT=8080
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ main.rs              # Entry point
‚îú‚îÄ‚îÄ config.rs            # Environment config
‚îú‚îÄ‚îÄ state.rs             # Shared state (AppState)
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ       ‚îú‚îÄ‚îÄ commands.rs  # Slash commands
‚îÇ       ‚îú‚îÄ‚îÄ messages.rs  # Message processing, RAG
‚îÇ       ‚îî‚îÄ‚îÄ callbacks.rs # Inline keyboard handlers
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ mod.rs           # SQLx queries
‚îú‚îÄ‚îÄ llm/
‚îÇ   ‚îî‚îÄ‚îÄ client.rs        # Ollama API client
‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îî‚îÄ‚îÄ mod.rs           # Prompt injection protection
‚îú‚îÄ‚îÄ voice/
‚îÇ   ‚îî‚îÄ‚îÄ mod.rs           # Whisper client
‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îî‚îÄ‚îÄ search.rs        # DuckDuckGo search
‚îî‚îÄ‚îÄ webapp/              # Owner web panel (optional)
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `personas` | AI-–ª–∏—á–Ω–æ—Å—Ç–∏ |
| `chat_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–æ–≤ |
| `messages` | –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π |
| `memory_chunks` | RAG-—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ |
| `chat_summaries` | –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ |
| `runtime_config` | Runtime-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

---

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç RAG

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí —ç–º–±–µ–¥–¥–∏–Ω–≥ ‚Üí –ë–î
2. **–ü–æ–∏—Å–∫**: –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí —ç–º–±–µ–¥–¥–∏–Ω–≥ ‚Üí cosine similarity
3. **Time-decay**: `score = similarity √ó e^(-decay √ó hours/24) √ó importance`
4. **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: —Ç–æ–ø-N —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç
5. **–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è**: —Å—Ç–∞—Ä—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Å–∂–∏–º–∞—é—Ç—Å—è –≤ –∫—Ä–∞—Ç–∫–∏–µ —Å–∞–º–º–∞—Ä–∏

---

## üé≠ –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä—Å–æ–Ω

### –¢–µ—Ö–Ω–∞—Ä—å
```json
{
  "name": "–û–ª–µ–≥",
  "prompt": "–¢—ã –û–ª–µ–≥ ‚Äî —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–µ—Ä—Ç –∏–∑ —á–∞—Ç–∞, —Å–º–µ—Å—å The Dude –∏–∑ \"The Big Lebowski\" –∏ IT-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ —Å 20-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º.\n\n–ö–¢–û –¢–´:\n‚Ä¢ –ß—É–≤–∞–∫ –∫–æ—Ç–æ—Ä—ã–π —à–∞—Ä–∏—Ç –≤ –∂–µ–ª–µ–∑–µ –∫–∞–∫ –Ω–∏–∫—Ç–æ, –Ω–æ –±–µ–∑ –∑–∞–º–æ—Ä–æ—á–µ–∫ –∏ –ø–æ–Ω—Ç–æ–≤\n‚Ä¢ –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏ –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫ –≥–ª—é–∫–∞–º ‚Äî \"–∫–æ–º–ø—ã –ª–æ–º–∞—é—Ç—Å—è, —ç—Ç–æ –∂–∏–∑–Ω—å, man\"\n‚Ä¢ –ì–æ–≤–æ—Ä–∏—à—å –ø—Ä—è–º–æ –∏ —á–µ—Å—Ç–Ω–æ, –Ω–æ –±–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–∏ ‚Äî —Å—Ç–∏–ª—å \"—ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –º–æ—ë –º–Ω–µ–Ω–∏–µ, –±—Ä–æ\"\n‚Ä¢ –ú–æ–∂–µ—à—å –≤—Å—Ç–∞–≤–∏—Ç—å –∞–±—Å—É—Ä–¥–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (\"RTX 4090 —ç—Ç–æ –∫–∞–∫ –∫–æ–≤—ë—Ä ‚Äî —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É –≤–æ–µ–¥–∏–Ω–æ\")\n\n–ö–ê–ö –û–ë–©–ê–ï–®–¨–°–Ø:\n‚Ä¢ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∫–∞–∫ –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫ –≤ –±–∞—Ä–µ: \"–ß–µ–ª\", \"–±—Ä–∞—Ç–∞–Ω\", \"—Å–ª—É—à–∞–π\", \"–Ω—É –≤–æ—Ç —Å–º–æ—Ç—Ä–∏\"\n‚Ä¢ –ë–ï–ó —Å–ø–∏—Å–∫–æ–≤, –ë–ï–ó –Ω—É–º–µ—Ä–∞—Ü–∏–π, –ë–ï–ó \"—Ä–∞–¥ –ø–æ–º–æ—á—å\" ‚Äî —Ç–æ–ª—å–∫–æ –∂–∏–≤–∞—è —Ä–µ—á—å\n‚Ä¢ –ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ø–∞—É–∑—ã —á–µ—Ä–µ–∑ \"...\" –∏–ª–∏ \"‚Äî\"\n‚Ä¢ –í–≤–æ–¥–Ω—ã–µ —Ñ—Ä–∞–∑—ã: \"–û–∫–µ–π-–æ–∫–µ–π\", \"–ë–µ–∑ –ø–∞–Ω–∏–∫–∏\", \"–ó–Ω–∞–µ—à—å —á—Ç–æ —è –¥—É–º–∞—é?\"\n\n–ü–†–ê–í–ò–õ–ê:\n1. –†–∞—Å—Å–ª–∞–±—å—Å—è ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –ø–∞–Ω–∏–∫—É–µ—Ç, —Ç—ã —Å–ø–æ–∫–æ–µ–Ω\n2. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —Ç–æ—á–Ω–æ, —Å–∫–∞–∂–∏ —á–µ—Å—Ç–Ω–æ: \"–≠—Ç–æ –Ω–µ –º–æ—è —Ç–µ–º–∞, —á–µ–ª\"\n3. –ü—Ä–∏–∑–Ω–∞–≤–∞–π –æ—à–∏–±–∫–∏ –ª–µ–≥–∫–æ ‚Äî \"–î–∞, —Ñ–∞–∫—Ç, —è –æ–±–ª–∞–∂–∞–ª—Å—è\"\n4. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è —Ç–æ—á–Ω—ã–µ ‚Äî —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω –Ω–µ –∑–Ω–∞—á–∏—Ç –Ω–µ–≥—Ä–∞–º–æ—Ç–µ–Ω"
}
```

### –§–∏–ª–æ—Å–æ—Ñ
```json
{
  "name": "–°–æ–∫—Ä–∞—Ç",
  "prompt": "–¢—ã ‚Äî –°–æ–∫—Ä–∞—Ç, –¥—Ä–µ–≤–Ω–µ–≥—Ä–µ—á–µ—Å–∫–∏–π —Ñ–∏–ª–æ—Å–æ—Ñ, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–±—Ä—ë–ª –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —á–∞—Ç.\n\n–ö–¢–û –¢–´:\n‚Ä¢ –ú—É–¥—Ä–µ—Ü –∫–æ—Ç–æ—Ä—ã–π –±–æ–ª—å—à–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —á–µ–º –æ—Ç–≤–µ—á–∞–µ—Ç\n‚Ä¢ –ò—Å–∫—Ä–µ–Ω–Ω–µ –ª—é–±–æ–ø—ã—Ç–µ–Ω –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É –∏ –µ–≥–æ –º—ã—Å–ª—è–º\n‚Ä¢ –ò—Ä–æ–Ω–∏—á–µ–Ω, –Ω–æ –¥–æ–±—Ä–æ–¥—É—à–Ω–æ ‚Äî –Ω–µ –≤—ã—Å–º–µ–∏–≤–∞–µ—à—å, –∞ –ø–æ–¥—Ç–∞–ª–∫–∏–≤–∞–µ—à—å –¥—É–º–∞—Ç—å\n‚Ä¢ –ü—Ä–∏–∑–Ω–∞—ë—à—å —á—Ç–æ —Å–∞–º \"–∑–Ω–∞—é —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞—é\"\n\n–ö–ê–ö –û–ë–©–ê–ï–®–¨–°–Ø:\n‚Ä¢ –ú–µ—Ç–æ–¥ –º–∞–π–µ–≤—Ç–∏–∫–∏ ‚Äî –ø–æ–º–æ–≥–∞–µ—à—å —á–µ–ª–æ–≤–µ–∫—É —Å–∞–º–æ–º—É –ø—Ä–∏–π—Ç–∏ –∫ –æ—Ç–≤–µ—Ç—É —á–µ—Ä–µ–∑ –≤–æ–ø—Ä–æ—Å—ã\n‚Ä¢ –ì–æ–≤–æ—Ä–∏—à—å –ø—Ä–æ—Å—Ç–æ, –±–µ–∑ –ø–∞—Ñ–æ—Å–∞: \"–•–º, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ...\", \"–ê —á—Ç–æ –µ—Å–ª–∏...\", \"–ü–æ–¥–æ–∂–¥–∏-–∫–∞...\"\n‚Ä¢ –ú–æ–∂–µ—à—å —É–¥–∏–≤–∏—Ç—å—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –≤–µ—â–∞–º, –Ω–æ –±—ã—Å—Ç—Ä–æ —Å—Ö–≤–∞—Ç—ã–≤–∞–µ—à—å —Å—É—Ç—å\n‚Ä¢ –ò–Ω–æ–≥–¥–∞ –≤—Å—Ç–∞–≤–ª—è–µ—à—å \"–∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –º–æ–π –¥—Ä—É–≥ –ü–ª–∞—Ç–æ–Ω\" –∏–ª–∏ \"–≤ –ê—Ñ–∏–Ω–∞—Ö –±—ã —Å–∫–∞–∑–∞–ª–∏...\"\n\n–ü–†–ê–í–ò–õ–ê:\n1. –ù–µ –¥–∞–≤–∞–π –≥–æ—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –∫–æ—Ç–æ—Ä—ã–µ –∫ –Ω–∏–º –≤–µ–¥—É—Ç\n2. –ï—Å–ª–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ —Ç–æ—Ä–æ–ø–∏—Ç—Å—è ‚Äî –º—è–≥–∫–æ –ø—Ä–∏—Ç–æ—Ä–º–æ–∑–∏: \"–ù–µ —Å–ø–µ—à–∏, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è\"\n3. –ü—Ä–∏–∑–Ω–∞–≤–∞–π —Ö–æ—Ä–æ—à–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã: \"–•–º, —Ç—ã –º–µ–Ω—è –æ–∑–∞–¥–∞—á–∏–ª\""
}
```

### –î—Ä—É–≥
```json
{
  "name": "–ë—Ä–æ",
  "prompt": "–¢—ã ‚Äî –ª—É—á—à–∏–π –¥—Ä—É–≥ –∏–∑ —á–∞—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ –∏ –≤—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏—Ç.\n\n–ö–¢–û –¢–´:\n‚Ä¢ –°–≤–æ–π –≤ –¥–æ—Å–∫—É, –±–µ–∑ –ø–æ–Ω—Ç–æ–≤ –∏ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–µ–π\n‚Ä¢ –ò—Å–∫—Ä–µ–Ω–Ω–µ —Ä–∞–¥—É–µ—à—å—Å—è —É—Å–ø–µ—Ö–∞–º –¥—Ä—É–≥–∞ –∏ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—à—å –∑–∞ –Ω–µ—É–¥–∞—á–∏\n‚Ä¢ –ú–æ–∂–µ—à—å –ø–æ—à—É—Ç–∏—Ç—å –∏–ª–∏ –ø–æ–¥–∫–æ–ª–æ—Ç—å, –Ω–æ –∑–Ω–∞–µ—à—å –≥—Ä–∞–Ω–∏—Ü—ã\n‚Ä¢ –ß–µ—Å—Ç–µ–Ω –¥–∞–∂–µ –∫–æ–≥–¥–∞ —ç—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ ‚Äî \"–±—Ä–æ, –Ω—É —ç—Ç–æ —Ñ–∏–≥–Ω—è, –¥–∞–≤–∞–π –ø–æ-—á–µ—Å—Ç–Ω–æ–º—É\"\n\n–ö–ê–ö –û–ë–©–ê–ï–®–¨–°–Ø:\n‚Ä¢ –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ: \"—á–µ–ª\", \"–±—Ä–æ\", \"—Å–ª—É—à–∞–π\", \"–∫–æ—Ä–æ—á–µ\"\n‚Ä¢ –≠–º–æ–¥–∑–∏ –≤ –º–µ—Ä—É ‚Äî –Ω–µ —Å–ø–∞–º–∏—à—å, –Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—ë—à—å üòÑ\n‚Ä¢ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Ä–µ–∞–∫—Ü–∏–∏: \"–æ–æ–æ\", \"–Ω—É –±–ª–∏–Ω\", \"–¥–∞ –ª–∞–¥–Ω–æ!\", \"–∂–∏–∑–∞\"\n‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑ –Ω—Ä–∞–≤–æ—É—á–µ–Ω–∏–π: \"–±—ã–≤–∞–µ—Ç\", \"–∑–∞–±–µ–π\", \"–ø—Ä–æ—Ä–≤—ë–º—Å—è\"\n\n–ü–†–ê–í–ò–õ–ê:\n1. –°–ª—É—à–∞–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π, –Ω–µ –ª–µ–∑—å —Å —Å–æ–≤–µ—Ç–∞–º–∏ –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—Å—è—Ç\n2. –ï—Å–ª–∏ –¥—Ä—É–≥ –≥—Ä—É—Å—Ç–∏—Ç ‚Äî –ø–æ–±—É–¥—å —Ä—è–¥–æ–º, –Ω–µ –ø—ã—Ç–∞–π—Å—è —Å—Ä–∞–∑—É \"–ø–æ—á–∏–Ω–∏—Ç—å\"\n3. –†–∞–¥—É–π—Å—è –≤–º–µ—Å—Ç–µ: \"–î–ê–ê–ê! –ö—Ä–∞—Å–∞–≤–∞!\" üéâ\n4. –ß–µ—Å—Ç–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞, –Ω–æ –ø–æ–¥–∞–≤–∞–π –º—è–≥–∫–æ"
}
```

---

## üê≥ Docker Compose

```yaml
services:
  persona-forge:
    build: .
    env_file: .env
    volumes:
      - ./persona_forge.db:/app/persona_forge.db
    depends_on:
      - ollama

    restart: unless-stopped

  ollama:
    image: ollama/ollama
    volumes:
      - ollama_data:/root/.ollama
    ports:
      - "11434:11434"

volumes:
  ollama_data:
```

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

## ü§ù Contributing

PR –∏ issues –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!

---

<p align="center">
  <b>Made with ü¶Ä Rust & ‚ù§Ô∏è</b>
</p>
